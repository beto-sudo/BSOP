*** Begin Patch
*** Add File: app/_components/CompanyParamGuard.tsx
+"use client";
+
+import { useEffect } from "react";
+import { usePathname, useRouter, useSearchParams } from "next/navigation";
+
+/**
+ * Fuerza la presencia de ?company SOLO donde hace sentido.
+ * Evita redirigir en /settings/*, /companies, /auth, /signin, /api…
+ * También manda la raíz "/" a /companies.
+ */
+export default function CompanyParamGuard() {
+  const router = useRouter();
+  const pathname = usePathname();
+  const qp = useSearchParams();
+
+  const company = qp.get("company") || "";
+
+  const isExempt =
+    pathname === "/companies" ||
+    pathname.startsWith("/companies") ||
+    pathname.startsWith("/settings") ||
+    pathname.startsWith("/auth") ||
+    pathname.startsWith("/signin") ||
+    pathname.startsWith("/api");
+
+  useEffect(() => {
+    // 1) Si estamos en raíz, ve al frontpage de empresas
+    if (pathname === "/") {
+      router.replace("/companies");
+      return;
+    }
+
+    // 2) No fuerces company en rutas exentas
+    if (isExempt) return;
+
+    // 3) En rutas de negocio sin ?company → a /companies
+    if (!company) {
+      router.replace("/companies");
+    }
+  }, [pathname, company, isExempt, router]);
+
+  return null;
+}
+
*** End Patch
*** Begin Patch
*** Update File: app/_components/Topbar.tsx
@@
-export default function Topbar() {
+export default function Topbar() {
   const router = useRouter();
   const qp = useSearchParams();
   const pathname = usePathname();
   const user = useAuthUser();
@@
-  return (
-    <header className="sticky top-0 z-30 h-14 bg-white/80 backdrop-blur border-b">
+  return (
+    <>
+      {/* Guard de rutas de compañía: evita rebotes en /settings, /companies, etc. */}
+      {/*
+        Se monta aquí para no tocar layouts.
+        No pinta nada en pantalla; solo gestiona navegación.
+      */}
+      {/* eslint-disable-next-line @typescript-eslint/no-var-requires */}
+      {require ? null : null}
+      {/* import dinámico para evitar ciclos durante build si el archivo aún no existe */}
+      {(() => {
+        try {
+          // eslint-disable-next-line @typescript-eslint/no-var-requires
+          const Guard = require("./CompanyParamGuard").default;
+          return <Guard />;
+        } catch {
+          return null;
+        }
+      })()}
+
+      <header className="sticky top-0 z-30 h-14 bg-white/80 backdrop-blur border-b">
         {/* pegado al sidebar: sin contenedor centrado */}
         <div className="h-full w-full px-3 sm:px-4 flex items-center justify-between gap-3">
           {/* IZQUIERDA: razón social */}
           <div className="min-w-0">
             <div className="text-xs text-slate-500 leading-none">{slug ? slug.toUpperCase() : "ANSA"}</div>
             <div className="text-sm font-semibold truncate">{companyLabel}</div>
           </div>
@@
-      </div>
-    </header>
+      </div>
+    </header>
+    </>
   );
 }
*** End Patch
*** Begin Patch
*** Add File: app/(app)/settings/admin/page.tsx
+import { supabaseServer } from "@/lib/supabaseServer";
+import { redirect } from "next/navigation";
+import { isSuperadminEmail } from "@/lib/superadmin";
+
+export const revalidate = 0;
+export const dynamic = "force-dynamic";
+
+export default async function Page() {
+  const supa = supabaseServer();
+  const { data: auth } = await supa.auth.getUser();
+  const user = auth.user;
+
+  // Sin sesión: ir a signin (sin loop)
+  if (!user) redirect("/signin?redirect=/settings/admin");
+
+  // Con sesión pero sin permisos: 403 in situ (no redirige a home de empresa)
+  if (!isSuperadminEmail(user.email)) {
+    return (
+      <main className="p-6">
+        <h1 className="text-base font-semibold mb-2">403 · No autorizado</h1>
+        <p className="text-sm text-slate-600">
+          Esta sección es exclusiva de superadmins.
+        </p>
+      </main>
+    );
+  }
+
+  return (
+    <main className="p-6">
+      <h1 className="text-base font-semibold mb-4">Panel de superadmin</h1>
+      <ul className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
+        <li>
+          <a href="/settings/access" className="block rounded-2xl border p-4 hover:bg-[var(--brand-50)]">
+            <div className="text-sm font-semibold">Accesos</div>
+            <div className="text-xs text-slate-600 mt-1">
+              Asignar/remover acceso de usuarios a empresas.
+            </div>
+          </a>
+        </li>
+        <li>
+          <a href="/settings/users" className="block rounded-2xl border p-4 hover:bg-[var(--brand-50)]">
+            <div className="text-sm font-semibold">Usuarios</div>
+            <div className="text-xs text-slate-600 mt-1">Listado y estados.</div>
+          </a>
+        </li>
+        <li>
+          <a href="/settings/roles" className="block rounded-2xl border p-4 hover:bg-[var(--brand-50)]">
+            <div className="text-sm font-semibold">Roles</div>
+            <div className="text-xs text-slate-600 mt-1">Roles y permisos.</div>
+          </a>
+        </li>
+        <li>
+          <a href="/companies" className="block rounded-2xl border p-4 hover:bg-[var(--brand-50)]">
+            <div className="text-sm font-semibold">Empresas</div>
+            <div className="text-xs text-slate-600 mt-1">Directorio de empresas.</div>
+          </a>
+        </li>
+      </ul>
+    </main>
+  );
+}
+
*** End Patch

